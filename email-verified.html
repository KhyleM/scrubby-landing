<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Scrubby | Email Verification</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--page-bg, radial-gradient(circle at top, rgba(45, 212, 191, 0.24), #f5f7fb));
        color: #0f172a;
        margin: 0;
        padding: 2rem;
      }
      .card {
        width: min(92vw, 440px);
        background: rgba(255, 255, 255, 0.94);
        border-radius: 24px;
        border: 1px solid rgba(15, 23, 42, 0.08);
        box-shadow: 0 32px 52px -24px rgba(15, 23, 42, 0.4);
        padding: clamp(1.5rem, 4vw, 3rem);
        text-align: center;
        backdrop-filter: blur(18px);
      }
      .icon {
        width: 76px;
        height: 76px;
        margin: 0 auto 1.5rem;
        border-radius: 50%;
        display: grid;
        place-items: center;
      }
      .icon.success {
        background: rgba(20, 184, 166, 0.16);
        color: #0d9488;
      }
      .icon.error {
        background: rgba(248, 113, 113, 0.16);
        color: #dc2626;
      }
      .icon svg {
        width: 42px;
        height: 42px;
      }
      h1 {
        margin: 0 0 1rem;
        font-size: clamp(1.8rem, 3vw, 2.2rem);
      }
      p {
        margin: 0 0 1.5rem;
        line-height: 1.6;
        color: #475569;
      }
      .actions {
        display: grid;
        gap: 0.75rem;
        margin-top: 2rem;
      }
      .button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        padding: 0.85rem 1.25rem;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        text-decoration: none;
        transition: transform 0.16s ease, box-shadow 0.16s ease;
      }
      .button.primary {
        background: linear-gradient(135deg, #2dd4bf, #14b8a6);
        color: #0f172a;
        box-shadow: 0 18px 36px -18px rgba(20, 184, 166, 1);
      }
      .button.primary:hover {
        transform: translateY(-1px);
      }
      .button.secondary {
        background: rgba(15, 23, 42, 0.08);
        color: #0f172a;
        border: 1px solid rgba(15, 23, 42, 0.1);
      }
      footer {
        margin-top: 2rem;
        font-size: 0.85rem;
        color: #64748b;
      }
      .hidden {
        display: none;
      }
      @media (prefers-color-scheme: dark) {
        body {
          --page-bg: radial-gradient(circle at top, rgba(45, 212, 191, 0.15), #0f172a);
          color: #e2e8f0;
        }
        .card {
          background: rgba(15, 23, 42, 0.78);
          border: 1px solid rgba(148, 163, 184, 0.16);
          color: inherit;
        }
        p {
          color: #cbd5f5;
        }
        .button.secondary {
          background: rgba(30, 41, 59, 0.6);
          color: #e2e8f0;
          border-color: rgba(148, 163, 184, 0.2);
        }
        footer {
          color: #94a3b8;
        }
      }
    </style>
  </head>
  <body>
    <main class="card" id="success-card">
      <div class="icon success" id="success-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h1 id="success-heading">Email Verified ðŸŽ‰</h1>
      <p id="success-message">
        Thanks for confirming your email! You can return to the Scrubby app and sign in.
      </p>
      <div class="actions">
        <a class="button primary" id="cta" href="https://scrubby.app/#/auth/login">Open Scrubby</a>
        <button class="button secondary" id="close">Close this tab</button>
      </div>
      <footer id="footnote">You can safely close this window.</footer>
    </main>

    <main class="card hidden" id="error-card">
      <div class="icon error" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h1>We couldn't verify the email</h1>
      <p id="error-message">
        The link may have expired. Try sending yourself a new verification email from the Scrubby app.
      </p>
      <div class="actions">
        <a class="button primary" href="https://scrubby.app/#/auth/login">Back to Scrubby</a>
      </div>
      <footer>Need help? Email support@scrubby.app.</footer>
    </main>

    <script>
      (function () {
        var successCard = document.getElementById('success-card');
        var errorCard = document.getElementById('error-card');
        var successHeading = document.getElementById('success-heading');
        var successMessage = document.getElementById('success-message');
        var footnote = document.getElementById('footnote');
        var cta = document.getElementById('cta');
        var closeBtn = document.getElementById('close');

        closeBtn.addEventListener('click', function () {
          window.close();
        });

        var hash = window.location.hash && window.location.hash.startsWith('#')
          ? window.location.hash.substring(1)
          : '';
        var params = new URLSearchParams(hash);
        var type = params.get('type');
        var error = params.get('error_description') || params.get('error');

        if (window.history && window.history.replaceState) {
          window.history.replaceState(null, '', window.location.pathname);
        }

        if (error) {
          successCard.classList.add('hidden');
          errorCard.classList.remove('hidden');
          document.getElementById('error-message').textContent = error;
          return;
        }

        if (type === 'recovery') {
          successHeading.textContent = 'Password Reset Link Confirmed';
          successMessage.textContent =
            'You\'re almost done. Return to the Scrubby app to finish choosing a new password.';
          cta.textContent = 'Open Scrubby';
          footnote.textContent = 'Keep the app open so you can complete the reset with your new password.';
          return;
        }

        if (type === 'email_change' || type === 'magiclink') {
          successHeading.textContent = 'All set!';
          successMessage.textContent =
            'Head back to Scrubby to keep going--your link worked perfectly.';
          cta.textContent = 'Open Scrubby';
          footnote.textContent = 'You can now return to the app to continue.';
          return;
        }

        successHeading.textContent = 'Email Verified ðŸŽ‰';
        successMessage.textContent =
          'Thanks for confirming your email! You can return to the Scrubby app and sign in.';
      })();
    </script>
  </body>
</html>
